name: Unit test
on:
  pull_request:
    branches:    
      - dev
jobs:
  unit_test:
    runs-on: ubuntu-latest
    steps:
      - name: Install dependencies (linux)
        run: sudo apt install ninja-build
      - name: Install Qt
        uses: jurplel/install-qt-action@v3
        with:
          version: '5.15.2'
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive
      - name: Setup
        run: |
          qmake --version
          cp app/qtquick/encryption_seed_template.h app/qtquick/encryption_seed.h
      - name: Build
        run: |
          qmake_dir=$(dirname $(which qmake))
          scripts/build.sh linux $qmake_dir
      - name: Build httpserver
        run: |
          mkdir 3rdparty/build-qthttpserver
          cd 3rdparty/build-qthttpserver
          qmake CONFIG+=debug_and_release ../qthttpserver/qthttpserver.pro
          make -j4 && make install
      - name: Unit test
        run: |
          qmake_dir=$(dirname $(which qmake))
          scripts/unittest.sh linux $qmake_dir
